{% extends "index.html" %}
{% block content %}

<div class="bg-light mb-2 p-3 rounded">
    <h2 class="d-flex justify-content-between w-100">
        {% set movie = movie|first %}
        <div class="w-100 mr-2 text-dark">
            {{ movie.title }}
        </div>
        <div class="">
            {% if movie.rating >= 4 %}
            <span class="badge badge-success">
            {% elif movie.rating >= 3 %}
            <span class="badge badge-warning">
            {% else %}
            <span class="badge badge-danger">
            {% endif %}
                {{ movie.rating | round(1) }}
            </span>
        </div>
    </h2>
    <p class="card-text">
        {% set genres = movie.genres.split('|') %}
        {% for genre in genres %}
        <span class="badge badge-secondary">{{ genre }}</span>
        {% endfor %}
    </p>
    <button class="btn btn-primary" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Rate movie</button> {%if rated %}You have rated the movie {{ user_rating }}{% endif %}
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Rate this movie</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="rating-form" action="{{ url_for('movie_page', id=movie.movieId, page=page) }}" method="post">
            <div class="form-group">
                <label for="_rating">Example select</label>
                <select class="form-control" data-type="range" id="_rating" name="rating">
                    <option value="0">0</option>
                    <option value="0.5">0.5</option>
                    <option value="1">1</option>
                    <option value="1.5">1.5</option>
                    <option value="2">2</option>
                    <option value="2.5">2.5</option>
                    <option value="3">3</option>
                    <option value="3.5">3.5</option>
                    <option value="4">4</option>
                    <option value="4.5">4.5</option>
                    <option value="5">5</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="bg-dark mb-2 p-3 rounded">
    <h2 class="mb-2 text-light">
        Movies Reviews
    </h2>
    <div class="card-columns">
        {% for review in reviews %}
        <div class="card">
            <div class="card-body">
                <h5 class="card-title d-flex justify-content-between w-100">
                    <div class="w-100 mr-2">
                        {{review.tag}}
                    </div>
                    <div class="">
                        {% if review.rating >= 4 %}
                        <span class="badge badge-success">
                        {% elif review.rating >= 3 %}
                        <span class="badge badge-warning">
                        {% else %}
                        <span class="badge badge-danger">
                        {% endif %}
                            {{ review.rating | round(1) }}
                        </span>
                    </div>
                </h5>
                <p class="card-text"><small class="text-muted">Added {{ review.timestamp | ctime }}</small></p>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="d-flex justify-content-center">
        <nav aria-label="pagination">
            <ul class="pagination">
                {% set next_page = page + 1 %}
                {% set prev_page = page - 1 %}
                <li class="page-item {% if prev_page < 1 %}disabled{% endif %}"><a class="page-link"
                                                                                   href="{{ url_for('movie_page', id=movie.movieId, page=prev_page) }}">Previous</a>
                </li>
                <li class="page-item"><a class="page-link">{{ page }}</a></li>
                <li class="page-item {% if all_movies|length < 10 %}disabled{% endif %}"><a class="page-link"
                                                                                            href="{{ url_for('movie_page', id=movie.movieId, page=next_page) }}">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>
{% endblock %}

